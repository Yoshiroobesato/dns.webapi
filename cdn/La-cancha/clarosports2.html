<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming Ultra Avanzado con Diseño Premium</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.js"></script>
    <style>
        :root {
            --primary-color: #00ff9d;
            --secondary-color: #ff00c8;
            --background-color: #1a1a1a;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            background: var(--background-color);
        }

        #video-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #custom-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 20px;
            display: flex;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #video-container:hover #custom-controls {
            opacity: 1;
        }

        .control-button {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            margin: 0 10px;
            cursor: pointer;
            transition: transform 0.2s ease, color 0.2s ease;
        }

        .control-button:hover {
            transform: scale(1.2);
            color: var(--primary-color);
        }

        #progress-bar {
            flex-grow: 1;
            height: 5px;
            background: rgba(255,255,255,0.3);
            position: relative;
            cursor: pointer;
            border-radius: 2.5px;
        }

        #progress {
            height: 100%;
            background: var(--primary-color);
            width: 0;
            border-radius: 2.5px;
            position: relative;
        }

        #progress::after {
            content: '';
            position: absolute;
            right: -10px;
            top: -7.5px;
            width: 20px;
            height: 20px;
            background: var(--secondary-color);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transform: scale(0);
            transition: transform 0.2s ease;
        }

        #progress-bar:hover #progress::after {
            transform: scale(1);
        }

        #error-overlay {
            display: none;
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            color: white;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #error-message {
            font-size: 24px;
            margin-bottom: 20px;
        }

        #retry-button {
            padding: 10px 20px;
            background: var(--primary-color);
            color: black;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        #retry-button:hover {
            background: var(--secondary-color);
        }

        #stats {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            transition: opacity 0.3s ease;
        }

        #video-container:hover #stats {
            opacity: 0.3;
        }

        #stats:hover {
            opacity: 1 !important;
        }

        .glow {
            animation: glow 1.5s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px var(--primary-color), 0 0 20px var(--primary-color);
            }
            to {
                text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px var(--secondary-color), 0 0 40px var(--secondary-color);
            }
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video"></video>
        <div id="custom-controls">
            <button id="play-pause" class="control-button">▶</button>
            <div id="progress-bar">
                <div id="progress"></div>
            </div>
            <button id="mute" class="control-button">🔊</button>
            <button id="fullscreen" class="control-button">⛶</button>
        </div>
        <div id="error-overlay">
            <div id="error-message" class="glow">Error en la reproducción</div>
            <button id="retry-button">Reintentar</button>
        </div>
        <div id="stats"></div>
    </div>

    <script>
        const manifestUri = 'https://update8915.pricesaskeloadsc.com:443/global/clarosports2/index.m3u8?token=c639897a3fe493212f3e66816683cc94a32b0d57-41-1723287124-1723251124';
        const video = document.getElementById('video');
        const errorOverlay = document.getElementById('error-overlay');
        const statsDiv = document.getElementById('stats');
        const playPauseButton = document.getElementById('play-pause');
        const muteButton = document.getElementById('mute');
        const fullscreenButton = document.getElementById('fullscreen');
        const progressBar = document.getElementById('progress-bar');
        const progress = document.getElementById('progress');
        const retryButton = document.getElementById('retry-button');

        let player;

        function initApp() {
            shaka.polyfill.installAll();
            if (shaka.Player.isBrowserSupported()) {
                initPlayer();
            } else {
                console.error('Browser not supported!');
            }
        }

        async function initPlayer() {
            player = new shaka.Player(video);

            player.configure({
                streaming: {
                    bufferingGoal: 30,
                    rebufferingGoal: 15,
                    bufferBehind: 30,
                    lowLatencyMode: true,
                    jumpLargeGaps: true,
                    retryParameters: {
                        maxAttempts: 10,
                        baseDelay: 1000,
                        backoffFactor: 2,
                        fuzzFactor: 0.5,
                        timeout: 30000,
                    }
                },
                abr: {
                    enabled: true,
                    defaultBandwidthEstimate: 1000000,
                    switchInterval: 8,
                    bandwidthUpgradeTarget: 0.85,
                    bandwidthDowngradeTarget: 0.95,
                }
            });

            player.addEventListener('error', onPlayerErrorEvent);

            try {
                await player.load(manifestUri);
                console.log('The video has now been loaded!');
                updateStats();
                setInterval(updateStats, 1000);
            } catch (error) {
                onPlayerError(error);
            }

            video.addEventListener('play', () => {
                errorOverlay.style.display = 'none';
                playPauseButton.textContent = '❚❚';
            });

            video.addEventListener('pause', () => {
                playPauseButton.textContent = '▶';
            });

            video.addEventListener('timeupdate', updateProgressBar);
        }

        function onPlayerErrorEvent(event) {
            onPlayerError(event.detail);
        }

        function onPlayerError(error) {
            console.error('Error code', error.code, 'object', error);
            errorOverlay.style.display = 'flex';
        }

        function updateStats() {
            if (player) {
                const stats = player.getStats();
                statsDiv.textContent = `
                    Bandwidth: ${Math.round(stats.estimatedBandwidth / 1000)} kbps
                    Buffer: ${Math.round(stats.bufferingTime * 10) / 10}s
                    Dropped Frames: ${stats.droppedFrames}
                    Current Resolution: ${stats.width}x${stats.height}
                `;
            }
        }

        function updateProgressBar() {
            const percentage = (video.currentTime / video.duration) * 100;
            progress.style.width = `${percentage}%`;
        }

        playPauseButton.addEventListener('click', () => {
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
        });

        muteButton.addEventListener('click', () => {
            video.muted = !video.muted;
            muteButton.textContent = video.muted ? '🔇' : '🔊';
        });

        fullscreenButton.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });

        progressBar.addEventListener('click', (e) => {
            const pos = (e.pageX - progressBar.offsetLeft) / progressBar.offsetWidth;
            video.currentTime = pos * video.duration;
        });

        retryButton.addEventListener('click', initPlayer);

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>